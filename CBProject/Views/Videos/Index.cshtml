@model IEnumerable<CBProject.Models.ViewModels.VideoViewModel>

<link rel="stylesheet" href="~/Content/Ratting.css">

@using Microsoft.AspNet.Identity
@using Microsoft.AspNet.Identity.EntityFramework
@using CBProject.Models

@{
    //var fullname = ((System.Security.Claims.ClaimsIdentity)User.Identity).FindFirst("FullName");
    //var user_image = ((System.Security.Claims.ClaimsIdentity)User.Identity).FindFirst("ImagePath");


    var context = new ApplicationDbContext();
    var userStore = new UserStore<ApplicationUser, ApplicationRole, string, IdentityUserLogin, IdentityUserRole, IdentityUserClaim>(context);
    var userManager = new CBProject.ApplicationUserManager(userStore);
    var currentUser = userManager.FindById(User.Identity.GetUserId());
    var roleStore = new RoleStore<ApplicationRole>(context);
    var roleManager = new RoleManager<ApplicationRole>(roleStore);


    var fullName = currentUser.FullName;
    var userImage = currentUser.ImagePath;
    RoleLevel access = RoleLevel.SUPERLOW;

    if (User.Identity.IsAuthenticated)
    {
        foreach (var role in currentUser.Roles)
        {
            var myRole = roleManager.FindById(role.RoleId);
            if (myRole.Level == RoleLevel.FULL)
            {
                access = myRole.Level;
            }
            else if (myRole.Level == RoleLevel.PLUSSFULL)
            {
                if (access != RoleLevel.FULL)
                {
                    access = myRole.Level;
                }
            }
            else if (myRole.Level == RoleLevel.MIDDLE)
            {
                if (access != RoleLevel.FULL &&
                    access != RoleLevel.PLUSSFULL)
                {
                    access = myRole.Level;
                }
            }
            else if (myRole.Level == RoleLevel.LOW)
            {
                if (access != RoleLevel.FULL &&
                    access != RoleLevel.PLUSSFULL &&
                    access != RoleLevel.MIDDLE)
                {
                    access = myRole.Level;
                }
            }
            else if (myRole.Level == RoleLevel.SUPERLOW)
            {
                if (access != RoleLevel.FULL &&
                    access != RoleLevel.PLUSSFULL &&
                    access != RoleLevel.MIDDLE &&
                    access != RoleLevel.LOW)
                {
                    access = myRole.Level;
                }
            }
        }
    }
}

<p>
    @Html.ActionLink("Create New", "Create")
</p>

@Scripts.Render("~/bundles/jquery")


<script type="text/javascript">
    $(function () {

        // Open _Tag Modal
        $("body").on('click', '#tag-modal-button-video', function () {
            var id = $(this).attr('data-id');
            $.ajax({
                url: '/Videos/_Tag/' + id,
                type: 'GET',
                success: function (response) {
                    $('.tag-modal-video').html(response);
                }
            });
        });

        // Open _Review Modal
        $("body").on('click', '#comment-modal-button-video', function () {
            var id = $(this).attr('data-id');
            $.ajax({
                url: '/Videos/_Review/' + id,
                type: 'GET',
                success: function (response) {
                    $('.review-modal-video').html(response);
                }
            });
        });

        // Open _Delete Modal
        $("body").on('click', '#delete-modal-button-video', function () {
            var id = $(this).attr('data-id');
            $.ajax({
                url: '/Videos/_Delete/' + id,
                type: 'GET',
                success: function (response) {
                    $('.delete-modal-video').html(response);
                }
            });
        });

        // Open _Edit Modal
        $("body").on('click', '#edit-modal-button-video', function () {
            var id = $(this).attr('data-id');
            $.ajax({
                url: '/Videos/_Edit/' + id,
                type: 'GET',
                success: function (response) {
                    $('.edit-modal-video').html(response);
                }
            });
        });

        // Open _Details Modal
        $("body").on('click', '#details-modal-button-video', function () {
            var id = $(this).attr('data-id');
            $.ajax({
                url: '/Videos/_Details/' + id,
                type: 'GET',
                success: function (response) {
                    $('.details-modal-video').html(response);
                }
            });
        });

    });
</script>

<div class="table-responsive">
    <table class="table" id="videos">
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Category.Name)
            </th>
            <th>
                @Html.DisplayName("Creator")
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Title)
            </th>
            @*<th>
                    Cover
                </th>*@
            @if (access == RoleLevel.FULL || access == RoleLevel.PLUSSFULL)
            {
                <th>
                    @Html.DisplayNameFor(model => model.Thumbnail)
                </th>
            }
            @*<th>
                    @Html.DisplayNameFor(model => model.VideoFile)
                </th>*@
            <th>
                @Html.DisplayNameFor(model => model.Description)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.UploadDate)
            </th>
            @*<th>
                    Rating
                </th>*@
            <th></th>
        </tr>

        @foreach (var item in Model)
        {
            if (float.IsNaN(item.Rate))
            {
                item.Rate = 0.1f;
            }
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Category.Name)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Creator.FullName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Title)
                </td>
                @*<td>
                        <img alt="Cover Foto" src="@item.VideoImagePath" style="height:150px;" />
                    </td>*@
                @if (access == RoleLevel.FULL || access == RoleLevel.PLUSSFULL)
                {
                    <td>
                        @Html.DisplayFor(modelItem => item.Thumbnail)
                    </td>
                }
                <!--<td>
                @{
                    var path = item.VideoPath;
                    if (item.VideoPath == null || item.VideoPath == "")
                    {
                        path = item.Url;
                    }
                }
                <video controls preload="metadata" height="200">-->
                @*poster="@item.VideoImagePath"*@
                <!--<source src="@path" type="video/mp4">
                    <source src="@path" type="video/webm" />
                    <source src="@path" type="video/ogg" />
                    Your browser does not support HTML5 video.
                </video>-->
                @*<iframe width="200" height="300" src="@path" allowfullscreen></iframe>*@
                <!--</td>-->
                <td>
                    @Html.DisplayFor(modelItem => item.Description)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.UploadDate)
                </td>
                @*
                    <td>
                        @using (Html.BeginForm("AddRate", "Videos", new { videoId = item.ID }, FormMethod.Post, new { id = "video-rating-form" }))
                        {
                            @Html.AntiForgeryToken()
                            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                            @Html.HiddenFor(model => item.ID)
                            <input name="rate"
                                   class="rating rating-loading"
                                   data-min="0"
                                   data-max="5"
                                   data-step="0.1"
                                   value="@item.Rate"> <!-- onchange="$('#video-rating-form').submit()" -->
                            <input type="submit" value="Submit" />
                        }
                    </td>*@



                <td>

                    @if (access == RoleLevel.FULL)
                    {
                        <button type="button" id="tag-modal-button-video" class="btn btn-dark tag-modal-button-video" data-toggle="modal" data-target="#tag-modal-video" data-id="@item.ID">Tag</button>
                        <button type="button" id="comment-modal-button-video" class="btn btn-primary comment-modal-button-video" data-toggle="modal" data-target="#review-modal-video" data-id="@item.ID">Comment</button>
                        <button type="button" id="details-modal-button-video" class="btn btn-info details-modal-button-video" data-toggle="modal" data-target="#details-modal-video" data-id="@item.ID">Details</button>
                        <button type="button" id="edit-modal-button-video" class="btn btn-success edit-modal-button-video" data-toggle="modal" data-target="#edit-modal-video" data-id="@item.ID">Edit</button>
                        <button type="button" id="delete-modal-button-video" class="btn btn-danger btn-delete delete-modal-button-video" data-toggle="modal" data-target="#delete-modal-video" data-id="@item.ID">Delete</button>
                    }
                    else if (access == RoleLevel.PLUSSFULL)
                    {
                        <button type="button" id="comment-modal-button-video" class="btn btn-primary comment-modal-button-video" data-toggle="modal" data-target="#review-modal-video" data-id="@item.ID">Comment</button>
                        <button type="button" id="details-modal-button-video" class="btn btn-info details-modal-button-video" data-toggle="modal" data-target="#details-modal-video" data-id="@item.ID">Details</button>
                        <button type="button" id="edit-modal-button-video" class="btn btn-success edit-modal-button-video" data-toggle="modal" data-target="#edit-modal-video" data-id="@item.ID">Edit</button>
                        <button type="button" id="delete-modal-button-video" class="btn btn-danger btn-delete delete-modal-button-video" data-toggle="modal" data-target="#delete-modal-video" data-id="@item.ID">Delete</button>
                    }
                    else if (access == RoleLevel.MIDDLE)
                    {
                        <button type="button" id="comment-modal-button-video" class="btn btn-primary comment-modal-button-video" data-toggle="modal" data-target="#review-modal-video" data-id="@item.ID">Comment</button>
                        <button type="button" id="details-modal-button-video" class="btn btn-info details-modal-button-video" data-toggle="modal" data-target="#details-modal-video" data-id="@item.ID">Details</button>
                        <button type="button" id="edit-modal-button-video" class="btn btn-success edit-modal-button-video" data-toggle="modal" data-target="#edit-modal-video" data-id="@item.ID">Edit</button>
                        <button type="button" id="delete-modal-button-video" class="btn btn-danger btn-delete delete-modal-button-video" data-toggle="modal" data-target="#delete-modal-video" data-id="@item.ID">Delete</button>
                    }
                    else if (access == RoleLevel.LOW)
                    {
                        <button type="button" id="comment-modal-button-video" class="btn btn-primary comment-modal-button-video" data-toggle="modal" data-target="#review-modal-video" data-id="@item.ID">Comment</button>
                    }
                    else if (access == RoleLevel.SUPERLOW)
                    {
                        <button type="button" id="comment-modal-button-video" class="btn btn-primary comment-modal-button" data-toggle="modal" data-target="#review-modal-video" data-id="@item.ID">Comment</button>
                    }
                    <style>
                        button {
                            margin: 5px;
                        }
                    </style>
                    @*@Html.ActionLink("Edit", "Edit", new { id = item.ID }) |
                        @Html.ActionLink("Details", "Details", new { id = item.ID }) |
                        @Html.ActionLink("Delete", "Delete", new { id = item.ID })*@
                </td>
            </tr>


        }

    </table>
</div>







<!-- Tag Modal -->
<div id="tag-modal-video" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Add Tag</h4>
            </div>
            <div class="modal-body tag-modal-video">

            </div>
            <div class="modal-footer">

            </div>
        </div>
    </div>
</div>

<!-- Review Modal -->
<div id="review-modal-video" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Add Comment</h4>
            </div>
            <div class="modal-body review-modal-video">

            </div>
            <div class="modal-footer">

            </div>
        </div>
    </div>
</div>

<!-- Delete Modal -->
<div id="delete-modal-video" class="modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete</h5>
            </div>
            <div class="modal-body delete-modal-video">

            </div>
            <div class="modal-footer">

            </div>
        </div>
    </div>
</div>

<!-- Edit Modal -->
<div id="edit-modal-video" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Modal Header</h4>
            </div>
            <div class="modal-body edit-modal-video">

            </div>
            <div class="modal-footer">

            </div>
        </div>
    </div>
</div>

<!-- Details Modal -->
<div id="details-modal-video" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Details</h4>
            </div>
            <div class="modal-body details-modal-video">

            </div>
            <div class="modal-footer">

            </div>
        </div>
    </div>
</div>

@section scripts{
    <script>
        $(document).ready(function () {
            var table = $("#videos").DataTable({
                ajax: {
                    url: "/videos/",
                    dataSrc: ""
                },
                columns: [
                    {
                        data: "title",
                        render: function (data, type, video) {
                            return "<a href='/videos/_edit/" + video.id + "'>" + video.Title + "</a>";
                        }
                    },

                ]
            });

        });
    </script>

    <script src="~/Scripts/Ratting.js"></script>

}